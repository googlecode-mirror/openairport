<?php 
//		  1		    2		  3		    4		  5		    6		  7		    7	      8		
//2345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345
//==============================================================================================
//	
//	ooooo	oooo	ooooo	o		o	ooooo	ooooo	oooo	oooo	ooooo	oooo	ooooo
//	o   o	o	o	o		oo		o	o	o	  o		o	o	o	o	o	o	o	o	  o
//	o	o	o	o	o		o o		o	o	o	  o		o	o	o	o	o	o	o	o	  o
//	o	o	oooo	oooo	o 	o	o	ooooo	  o		oooo	oooo	o	o	oooo	  o	
//	o	o	o		o		o  	 o	o	o	o	  o		o  o	o		o	o	o  o	  o
//	o	o	o		o		o	  o	o	o	o	  o		o	o	o		o	o	o   o	  o
//	00000	0		ooooo	o		o	o	o	ooooo	o	o	o		ooooo	o	o     o
//
//	The premium quality open source software soultion for airport record keeping requirements
//
//	Designed, Coded, and Supported by Erick Dahl
//
//	Copywrite 2002 - Whatever the current year is
//
//	~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~
//	
//	Name of Document		:	part139333_report_enter_new.php
//
//	Purpose of Page			:	Enter New Part139.333 Protection of Navaid Inspection
//
//	Special Notes			:	Change the information here for your airport.
//
//==============================================================================================
//2345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345
//		  1		    2		  3		    4		  5		    6		  7		    7	      8	

// PURPOSE:  ha...
?>
	<td>	
		<table border="0" width="100%" class="formoptionsavilablebottom">

<?php
for ($j=0; $j<=count($arunwayheading); $j=$j+1) {

		$sql2 = "SELECT * FROM tbl_139_333_sub_c
				INNER JOIN tbl_139_333_sub_c_f	ON tbl_139_333_sub_c_f.facility_id = tbl_139_333_sub_c.condition_facility_cb_int 
				INNER JOIN tbl_inventory_sub_e	ON tbl_inventory_sub_e.equipment_id = tbl_139_333_sub_c.condition_tied_id 
				INNER JOIN tbl_139_333_sub_t	ON tbl_139_333_sub_t.inspection_type_id = tbl_139_333_sub_c.condition_type_cb_int 
				WHERE tbl_inventory_sub_e.equipment_name = '".$arunwayheading[$j]."' AND condition_archived_yn = 0
				ORDER BY tbl_inventory_sub_e.equipment_name, tbl_139_333_sub_c_f.facility_name, condition_name"; 
				
		//echo "[1]. The SQL Statement is :".$sql." <br>";
		//echo "[2]. Create Connection Object <br>";
		
		$objcon2 = mysqli_connect($GLOBALS['hostdomain'], $GLOBALS['hostusername'], $GLOBALS['passwordofdatabase'], $GLOBALS['nameofdatabase']);
		
		//echo "[3]. Attempt Connection to Database <br>";		
							
		if (mysqli_connect_errno()) {
		
				//echo "[4]. Connection to Database Rejected/Unsuccessful <br>";				
		
				printf("connect failed: %s\n", mysqli_connect_error());
				exit();
			}
			else {
			
				//echo "[5]. Connection to Database Successful <br>";		
			
				$res2 = mysqli_query($objcon2, $sql2);
				if ($res2) {
						$number_of_rows = mysqli_num_rows($res2);
						
						//echo "[6]. There are | ".$number_of_rows." | rows in this recordset <br>";	

						$counter 				= 0;
						$previousequipmentid	= 0;

						while ($objfields2 = mysqli_fetch_array($res2, MYSQLI_ASSOC)) {
						
								$tmpid2 		= $objfields2['conditions_id'];
								$tmpcname2		= $objfields2['condition_name'];
								
								echo 	$tmpid2;
								
								$aspecs			= part139333_get_specifications($tmpid2);
								
								echo 	$aspecs[0];
								
								
								$tmpequiid2		= $objfields2['condition_tied_id'];
								$tmpequiln2		= $objfields2['equipment_name'];
								
								// Get Runwayway Heading from Equipment ID
								// Format of Equipment name is 'PAPI xxby'
								// Where xx is the runway heading and y is the box number.
								$runwayheading2 = substr($tmpequiln,5, 2);
								
								//echo "[8b]. Runway Heading is | ".$runwayheading." | <br>";	
								
								$tmpfacid2		= $objfields2['condition_facility_cb_int'];
								$tmpfacname2 	= $objfields2['facility_name'];
								
								$tmptypeid2		= $objfields2['condition_type_cb_int'];
								$tmptypeln2		= $objfields2['inspection_type'];
								$tmptypesn2		= $objfields2['inspection_type_short_name'];					
						
							//echo "[20]. Looping within the Sub Blockform <br>";
							//echo "[21]. All Equipment Names will be the same here, What seperatesis the condiction checklist <br>";
							
								if($previousequipmentid == $tmpequiid2) {
										// Nothing Displayed
										$displayrow = 1;
									}
									else {
										// Not equal to, end and begin a nbew table
										?>
					</table>
				</td>
			<td>
				<table border="2" width="100%">
					<tr>
						<td align="center" valign="middle" colspan="2" bgcolor="#FFFFFF" background="images/part_139_327/cellbackground.png" >
							<?php echo $tmpequiln2;?>
							</td>
						</tr>
					<tr>
										<?php
										$displayrow = 1;
									}
								
								if($displayrow == 1) {
										?>
					<tr>
						<td class="formoptions">
							<?php echo $tmpfacname2;?>
							</td>
							<td>
										<?php
										if($tmpfacid2 == 1 OR $tmpfacid2 == 5) {
												
												// Need to get any proper specifications for this condition/facility mix.
												// to do
												
												?>
										<input class="commonfieldbox" 	type="text" ID="<?=$tmpe;?>" 	name="<?=$tmpe;?>" 		size="2" value="1"> 
										<input class="commonfieldbox" 	type="text" ID="<?=$tmpee;?>" 	name="<?=$tmpee;?>" 	size="2" value="<?php echo $aspecs[0];?>" >
										<input class="commonfieldbox" 	type="text" ID="<?=$tmpeee;?>" 	name="<?=$tmpeee;?>" 	size="2" > 
												<?php
											}
											else {
												gs_conditions("all", "no", $tmpe, "show", 5);
											}
											?>
								</td>						
						</tr>
											<?php
									}
											
							$check					= 0;
							$counter 				= $counter + 1;
							$previousequipmentid	= $tmpequiid2;
							}
					}
			}
			?>
	<?php
			
	}
	?>
			</table>
		</td>